local Players = game:GetService("Players")
local player = Players.LocalPlayer

local teleportPosition = Vector3.new(-72, 164, -4716)

-- Función para aplicar el anti-fling DESPUÉS del teleport
local function applyAntiFling(character)
    local humanoid = character:WaitForChild("Humanoid")
    local rootPart = character:WaitForChild("HumanoidRootPart")

    -- Aplicamos el Anti-Fling (después del TP)
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CustomPhysicalProperties = PhysicalProperties.new(9e110, 9e110, 9e110)
            part.CanCollide = false
            part.Anchored = true
        end
    end

    humanoid.WalkSpeed = 0
    humanoid.JumpHeight = 0
    humanoid.PlatformStand = true

    -- Asegura que la posición sea fija sin movimiento
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(400000, 400000, 400000)
    bodyPosition.D = 10000
    bodyPosition.P = 10000
    bodyPosition.Position = rootPart.Position
    bodyPosition.Parent = rootPart

    local bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)
    bodyGyro.CFrame = rootPart.CFrame
    bodyGyro.Parent = rootPart
end

-- Función para hacer teleport cuando el personaje esté cargado
local function onCharacterAdded(character)
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    
    -- Espera brevemente para asegurar que el personaje esté completamente listo
    task.wait(0.5)

    -- Teletransporta antes de aplicar antifling
    humanoidRootPart.CFrame = CFrame.new(teleportPosition)

    -- Aplica el antifling después del TP
    applyAntiFling(character)
end

-- Conectar evento para cuando el personaje respawnea
player.CharacterAdded:Connect(onCharacterAdded)

-- Si el personaje ya existe
if player.Character then
    onCharacterAdded(player.Character)
end
